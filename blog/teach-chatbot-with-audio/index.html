<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Teach a Q&amp;A Chatbot with Audio Recordings | Prem - Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://dev.premai.io/blog/teach-chatbot-with-audio"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="title" content="Prem - Developer Portal."><meta data-rh="true" property="og:title" content="Teach a Q&amp;A Chatbot with Audio Recordings | Prem - Developer Portal"><meta data-rh="true" name="description" content="Build a chatbot to answer questions about audio recordings with Prem using LangChain, Whisper audio transcription, All MiniLM embeddings, Weaviate vector store and Vicuna 7B LLM, self-hosted on your laptop"><meta data-rh="true" property="og:description" content="Build a chatbot to answer questions about audio recordings with Prem using LangChain, Whisper audio transcription, All MiniLM embeddings, Weaviate vector store and Vicuna 7B LLM, self-hosted on your laptop"><meta data-rh="true" property="og:image" content="https://dev.premai.io/assets/images/banner-2dab08c15689cf175a9b63e7b940916e.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-08-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/htrivedi99,https://github.com/casperdcl"><meta data-rh="true" property="article:tag" content="llm,self-hosted,prem,open-source,fintech,langchain,vicuna-7b,weaviate,vector-store,streamlit"><meta data-rh="true" name="twitter:image" content="./banner.png"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://dev.premai.io/blog/teach-chatbot-with-audio"><link data-rh="true" rel="alternate" href="https://dev.premai.io/blog/teach-chatbot-with-audio" hreflang="en"><link data-rh="true" rel="alternate" href="https://dev.premai.io/blog/teach-chatbot-with-audio" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Prem - Developer Portal RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Prem - Developer Portal Atom Feed">






<script src="https://analytics.prem.ninja/js/script.js" defer="defer" data-domain="dev.premai.io"></script><link rel="stylesheet" href="/assets/css/styles.45db41c1.css">
<link rel="preload" href="/assets/js/runtime~main.2b90d7f0.js" as="script">
<link rel="preload" href="/assets/js/main.c8a23f3b.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Prem AI logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Prem AI logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Developer Portal</b></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/premAI-io/prem-app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/prem-app-v0-2-enhanced-speed-without-docker">Introducing Prem App v0.2.x: Enhanced Speed and Simplified Usage Without Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/install-prem-on-aws-llmops-in-production">Install Prem on AWS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/evaluating-open-source-llms">Evaluating Open-Source Large Language Models</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mlops-more-oops-than-ops">MLOps: More Oops than Ops</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/teach-chatbot-with-audio">Teach a Q&amp;A Chatbot with Audio Recordings</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://dev.premai.io/assets/images/banner-2dab08c15689cf175a9b63e7b940916e.png"><header><h1 class="title_xvU1" itemprop="headline">Teach a Q&amp;A Chatbot with Audio Recordings</h1><div class="container_iJTo margin-vert--md"><time datetime="2023-08-03T00:00:00.000Z" itemprop="datePublished">August 3, 2023</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://github.com/htrivedi99" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/htrivedi99.png" alt="Het Trivedi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/htrivedi99" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Het Trivedi</span></a></div><small class="avatar__subtitle" itemprop="description">Developer Advocate</small></div></div></div><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://github.com/casperdcl" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/casperdcl.png" alt="Casper da Costa-Luis"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/casperdcl" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Casper da Costa-Luis</span></a></div><small class="avatar__subtitle" itemprop="description">Core contributor @ PremAI</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Prem Banner" src="/assets/images/banner-2dab08c15689cf175a9b63e7b940916e.png" width="2238" height="675" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="financial-use-case">Financial Use Case<a href="#financial-use-case" class="hash-link" aria-label="Direct link to Financial Use Case" title="Direct link to Financial Use Case">​</a></h2><p>Publicly traded companies are required to report to their investors. In the US, companies typically have a live call with their investors before publishing quarterly (<a href="https://www.investor.gov/introduction-investing/investing-basics/glossary/form-10-q" target="_blank" rel="noopener noreferrer">10-Q</a>) and annual (<a href="https://www.investor.gov/introduction-investing/investing-basics/glossary/form-10-k" target="_blank" rel="noopener noreferrer">10-K</a>) earnings reports. People on the call receive important information quicker than those who wait for written reports.</p><blockquote><p>Can we capture all the information from a live earnings call without having to sit through the entire thing or wait for official written reports?</p></blockquote><p>Yes!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="processing-audio-with-ai">Processing Audio with AI<a href="#processing-audio-with-ai" class="hash-link" aria-label="Direct link to Processing Audio with AI" title="Direct link to Processing Audio with AI">​</a></h2><p>The open-source <a href="https://doi.org/10.48550/arXiv.2212.04356" target="_blank" rel="noopener noreferrer">Whisper Tiny</a> model can convert audio into text. This model is small enough to run on your CPU and can process hours of audio quickly (in seconds) and accurately.</p><p>We can then use an open-source large language model (LLM) such as <a href="https://vicuna.lmsys.org" target="_blank" rel="noopener noreferrer">Vicuna</a> to query or &quot;chat&quot; with the text in a more human-friendly way than a basic <code>Ctrl + F</code> ever could. We could ask questions like &quot;where has the revenue grown most this year?&quot; or &quot;what was the net revenue for the quarter?&quot;</p><p>The steps required to build this app are:</p><ol><li>Serve the Whisper Tiny audio-to-text model locally</li><li>Send our audio file to the model and receive the resulting text</li><li>Split the text into manageable chunks using <a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer">LangChain</a></li><li>Store the chunks inside a vector database provided by <a href="https://github.com/weaviate/weaviate" target="_blank" rel="noopener noreferrer">Weaviate</a></li><li>Query the data stored in the vector database</li><li>Chat with the data using the Vicuna LLM</li></ol><p>There are quite a few technologies here and it can be difficult to run them all manually. We&#x27;ll use Prem AI to easily handle most of this without having to wrestle with any setup -- including the Whisper Tiny model, Weaviate vector database, embeddings tool, and the Vicuna LLM.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-setup-requirements">Step 1: Setup Requirements<a href="#step-1-setup-requirements" class="hash-link" aria-label="Direct link to Step 1: Setup Requirements" title="Direct link to Step 1: Setup Requirements">​</a></h2><p>Simply <a href="https://dev.premai.io/docs/category/installation" target="_blank" rel="noopener noreferrer">install &amp; run the Prem App</a>. Using the app&#x27;s UI, start these services:</p><ul><li><a href="https://registry.premai.io/detail.html?service=whisper-tiny" target="_blank" rel="noopener noreferrer">Whisper Tiny</a> (under <em>Audio-to-Text</em>),</li><li><a href="https://registry.premai.io/detail.html?service=all-minilm-l6-v2" target="_blank" rel="noopener noreferrer">All MiniLM L6 v2</a> (under <em>Embeddings</em>),</li><li><a href="https://registry.premai.io/detail.html?service=weaviate" target="_blank" rel="noopener noreferrer">Weaviate</a> (under <em>Vector-Store</em>), and</li><li><a href="https://registry.premai.io/detail.html?service=vicuna-7b-q4" target="_blank" rel="noopener noreferrer">Vicun-7B q4</a> (under <em>Chat</em>).</li></ul><p>Note that there are many other services you could select from instead (e.g. a larger <em>Chat</em> model if your GPU memory is large enough).</p><p><img loading="lazy" src="/assets/images/prem_dashboard-67603b3e65d27f8fccb07c3a69baf9e2.png" width="2576" height="1348" class="img_ev3q"> </p><p>Each service runs in a Docker container, and can be started/stopped via the app.</p><p><img loading="lazy" src="/assets/images/prem_service_details-092b5a10f78f03b6eca6f85e11d2de6a.png" width="976" height="1306" class="img_ev3q"> </p><p>Click on a running service to see usage docs and Docker container info. Notice the <code>Default External Port</code>, which we will use below to interact with each of these services via their API endpoints.</p><p>Next, install some Python dependencies:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token plain">python -m pip install langchain openai streamlit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-transcribe-audio-totext">Step 2: Transcribe Audio to Text<a href="#step-2-transcribe-audio-totext" class="hash-link" aria-label="Direct link to Step 2: Transcribe Audio to Text" title="Direct link to Step 2: Transcribe Audio to Text">​</a></h2><p>We&#x27;ll create a <code>convert_audio_to_text</code> function which sends a given audio file to our Prem AI managed audio-to-text model, and returns the transcribed text.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> openai</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">embeddings </span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># URL API endpoints obtained from the Prem App UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">openai</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">api_key </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;OPENAI_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;random-string&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">whisper_url </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;http://127.0.0.1:10111/v1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># audio-to-text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">embeddings </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> OpenAIEmbeddings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">openai_api_base</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;http://127.0.0.1:8444/v1&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">weaviate_url </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;http://127.0.0.1:8080&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># vector store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">vicuna_api </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;http://127.0.0.1:8111/v1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># LLM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">convert_audio_to_text</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">audio_file_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    openai</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">api_base </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> whisper_url</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    </span><span class="token keyword" style="color:#C586C0">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">audio_file_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;rb&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:#C586C0">as</span><span class="token plain"> audio_file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        transcript </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> openai</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Audio</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">transcribe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;whisper-1&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> audio_file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        </span><span class="token keyword" style="color:#C586C0">return</span><span class="token plain"> transcript</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-split-text-into-chunks">Step 3: Split Text into Chunks<a href="#step-3-split-text-into-chunks" class="hash-link" aria-label="Direct link to Step 3: Split Text into Chunks" title="Direct link to Step 3: Split Text into Chunks">​</a></h2><p>We define a <code>create_chunks</code> function to split the text into smaller pieces which are much easier to process.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token keyword" style="color:#C586C0">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">text_splitter </span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> RecursiveCharacterTextSplitter</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">create_chunks</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    text_splitter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> RecursiveCharacterTextSplitter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        chunk_size</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:#B5CEA8">500</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> chunk_overlap</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:#B5CEA8">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> length_function</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token builtin" style="color:rgb(86, 156, 214)">len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    </span><span class="token keyword" style="color:#C586C0">return</span><span class="token plain"> text_splitter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">create_documents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-save-chunks-into-vectorstore">Step 4: Save Chunks into Vector Store<a href="#step-4-save-chunks-into-vectorstore" class="hash-link" aria-label="Direct link to Step 4: Save Chunks into Vector Store" title="Direct link to Step 4: Save Chunks into Vector Store">​</a></h2><p>An <code>add_to_vectorstore</code> function will save the chunks in our Prem-managed vector store, making them easy to query later.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token keyword" style="color:#C586C0">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">docstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">document </span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> Document</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">vectorstores </span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> VectorStore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Weaviate</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">add_to_vectorstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">texts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> VectorStore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    documents </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">Document</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">page_content</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">page_content</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:#C586C0">for</span><span class="token plain"> t </span><span class="token keyword" style="color:#C586C0">in</span><span class="token plain"> texts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    </span><span class="token keyword" style="color:#C586C0">return</span><span class="token plain"> Weaviate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">from_documents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        documents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> embeddings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> weaviate_url</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">weaviate_url</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> by_text</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token boolean" style="color:#569CD6">False</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the All MiniLM L6 v2 <code>embeddings</code> endpoint is used to convert our text into vectors.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-query-the-vectorstore">Step 5: Query the Vector Store<a href="#step-5-query-the-vectorstore" class="hash-link" aria-label="Direct link to Step 5: Query the Vector Store" title="Direct link to Step 5: Query the Vector Store">​</a></h2><p>We can query against them using the <code>similarity_search_by_vector</code> function.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token keyword" style="color:#C586C0">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">query_vectorstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> vectorstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> VectorStore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">str</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    query_vector </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> embeddings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">embed_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    docs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> vectorstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">similarity_search_by_vector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query_vector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> k</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:#B5CEA8">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    </span><span class="token keyword" style="color:#C586C0">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;\n\n&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">page_content </span><span class="token keyword" style="color:#C586C0">for</span><span class="token plain"> doc </span><span class="token keyword" style="color:#C586C0">in</span><span class="token plain"> docs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here&#x27;s how this works:</p><ul><li>The input query (our question) is converted into a vector using <code>embeddings.embed_query</code></li><li>The vector database is searched for similar vectors</li><li>The original text (corresponding to those vectors) is returned</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-combine-everything-in-a-chatbot-gui">Step 6: Combine Everything in a ChatBot GUI<a href="#step-6-combine-everything-in-a-chatbot-gui" class="hash-link" aria-label="Direct link to Step 6: Combine Everything in a ChatBot GUI" title="Direct link to Step 6: Combine Everything in a ChatBot GUI">​</a></h2><p>We&#x27;ll select an <code>mp3</code> audio file to use via a Streamlit UI. In this case, we&#x27;ll use <a href="https://github.com/htrivedi99/prem-blogs/blob/main/quarterly-earnings-chatbot/nvidia_earnings_call.mp3" target="_blank" rel="noopener noreferrer">this audio snippet</a> extracted from <a href="https://www.youtube.com/watch?v=7qU_wzzYNJU" target="_blank" rel="noopener noreferrer">NVIDIA&#x27;s recent Q4 2023 earnings call</a>.</p><p>Then we&#x27;ll use the functions defined above to support an LLM-driven chatbot!</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> tempfile</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> streamlit </span><span class="token keyword" style="color:#C586C0">as</span><span class="token plain"> st</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">chat_models </span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> ChatOpenAI</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">schema </span><span class="token keyword" style="color:#C586C0">import</span><span class="token plain"> HumanMessage</span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">chat </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ChatOpenAI</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">openai_api_base</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">vicuna_api</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> max_tokens</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:#B5CEA8">256</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">title</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Chat with audio files&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">with</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">sidebar</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    upload_file </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">file_uploader</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Choose an audio file&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    </span><span class="token keyword" style="color:#C586C0">if</span><span class="token plain"> upload_file </span><span class="token keyword" style="color:#C586C0">is</span><span class="token plain"> </span><span class="token keyword" style="color:#C586C0">not</span><span class="token plain"> </span><span class="token boolean" style="color:#569CD6">None</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        </span><span class="token keyword" style="color:#C586C0">with</span><span class="token plain"> tempfile</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">NamedTemporaryFile</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:#C586C0">as</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">            tmp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">upload_file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Converting audio to text...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">            text </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> convert_audio_to_text</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">tmp</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">            st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;... done!&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">            chunks </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> create_chunks</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">            vector_db </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> add_to_vectorstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">chunks</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">user_input </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">text_input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Enter your question here...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain"></span><span class="token keyword" style="color:#C586C0">if</span><span class="token plain"> user_input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    context </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> query_vectorstore</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_input</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> vector_db</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    messages </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">HumanMessage</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">content</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Use the context below to answer the question.\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">        </span><span class="token string-interpolation string" style="color:rgb(206, 145, 120)">f&quot;Context: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string-interpolation interpolation">context</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string-interpolation string" style="color:rgb(206, 145, 120)">. \nQuestion: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token string-interpolation interpolation">user_input</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token string-interpolation string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Generating...&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    res </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> chat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">messages</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D4D4D4"><span class="token plain">    st</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To answer our questions correctly, we need to provide the LLM with some context.
This context is given by the text we obtained from our vector database from a similarity search (finding transcribed audio extracts similar to our question).</p><p>To run everything, place all the Python code above into a file <code>audiobot.py</code> and run it using <code>streamlit</code>:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D4D4D4;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D4D4D4"><span class="token plain">streamlit run audiobot.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A browser window should open displaying your shiny new audio transcription chatbot app!</p><p>The <a href="https://github.com/htrivedi99/prem-blogs/tree/main/quarterly-earnings-chatbot" target="_blank" rel="noopener noreferrer">full source code for this tutorial is available here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>We took a practical use case -- extracting information from an earnings call -- and applied state-of-the-art AI techniques to convert the audio stream into text, and load the text into a vector database. We asked questions about the text in natural (human) language, and used a vector similarity search and an LLM to answer these questions.</p><p>The applications for this project go well beyond just earnings calls, as any kind of audio can be processed. For example, you can summarise a video recording from a meeting, lecture, or even YouTube.</p><p>Using Prem AI you can easily experiment with different open-source AI building blocks to help you build applications for your particular use case.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_Wr5y"><div class="col"><ul class="tags_ysAR padding--none"><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/llm">llm</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/self-hosted">self-hosted</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/prem">prem</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/open-source">open-source</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fintech">fintech</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/langchain">langchain</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vicuna-7-b">vicuna-7b</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/weaviate">weaviate</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vector-store">vector-store</a></li><li class="tag_DyE2"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/streamlit">streamlit</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/premAI-io/dev-portal/blob/main/blog/2023-08-03-teach-chatbot-with-audio/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/mlops-more-oops-than-ops"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">MLOps: More Oops than Ops</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/chainlit-langchain-prem"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Talk to your Data with ChainLit and Langchain</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#financial-use-case" class="table-of-contents__link toc-highlight">Financial Use Case</a></li><li><a href="#processing-audio-with-ai" class="table-of-contents__link toc-highlight">Processing Audio with AI</a></li><li><a href="#step-1-setup-requirements" class="table-of-contents__link toc-highlight">Step 1: Setup Requirements</a></li><li><a href="#step-2-transcribe-audio-totext" class="table-of-contents__link toc-highlight">Step 2: Transcribe Audio to Text</a></li><li><a href="#step-3-split-text-into-chunks" class="table-of-contents__link toc-highlight">Step 3: Split Text into Chunks</a></li><li><a href="#step-4-save-chunks-into-vectorstore" class="table-of-contents__link toc-highlight">Step 4: Save Chunks into Vector Store</a></li><li><a href="#step-5-query-the-vectorstore" class="table-of-contents__link toc-highlight">Step 5: Query the Vector Store</a></li><li><a href="#step-6-combine-everything-in-a-chatbot-gui" class="table-of-contents__link toc-highlight">Step 6: Combine Everything in a ChatBot GUI</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/prem" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.com/invite/kpKk6vYVAn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/premai_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/premAI-io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Prem Labs, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2b90d7f0.js"></script>
<script src="/assets/js/main.c8a23f3b.js"></script>
</body>
</html>